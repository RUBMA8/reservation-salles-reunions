<div class="admin-section">
  <h1>Toutes les RÃ©servations</h1>

  <div class="reservations-list">
    {{#each reservations}}
      <div class="reservation-card">
        <div class="reservation-header">
          <h3>ğŸ¢ {{salle_nom}}</h3>
          <p class="statut statut-{{statut}}">
            {{#ifEquals statut 'active'}}
              âœ… Active
            {{/ifEquals}}
            {{#ifEquals statut 'annulee'}}
              âŒ AnnulÃ©e
            {{/ifEquals}}
          </p>
        </div>

        <div class="reservation-details">
          <p>ğŸ‘¤ <strong>Utilisateur:</strong> {{user_prenom}} {{user_nom}} ({{user_email}})</p>
          <p>ğŸ“… <strong>DÃ©but:</strong> {{formatDate date_debut}}</p>
          <p>ğŸ“… <strong>Fin:</strong> {{formatDate date_fin}}</p>
          {{#if motif}}
            <p>ğŸ“ <strong>Motif:</strong> {{motif}}</p>
          {{/if}}
          <p>ğŸ‘¥ <strong>CapacitÃ© salle:</strong> {{capacite}} personnes</p>
          <p>ğŸ“† <strong>CrÃ©Ã©e le:</strong> {{formatDate created_at}}</p>
        </div>

        {{#ifEquals statut 'active'}}
          <div class="card-actions">
            <button onclick="cancelReservation({{id}})" class="btn btn-danger btn-sm">
              âŒ Annuler cette rÃ©servation
            </button>
          </div>
        {{/ifEquals}}
      </div>
    {{else}}
      <div class="alert alert-info">
        <p>Aucune rÃ©servation pour le moment.</p>
      </div>
    {{/each}}
  </div>

  <a href="/admin/dashboard" class="btn btn-secondary mt-20">â† Retour au tableau de bord</a>
</div>

<script>
async function cancelReservation(id) {
  if (!confirm('ÃŠtes-vous sÃ»r de vouloir annuler cette rÃ©servation ?\n\nCette action est irrÃ©versible.')) {
    return;
  }

  try {
    const response = await fetch(`/reservations/${id}`, {
      method: 'DELETE',
      headers: {
        'Accept': 'application/json'
      }
    });

    if (response.ok) {
      alert('âœ… RÃ©servation annulÃ©e!');
      window.location.reload();
    } else {
      const result = await response.json();
      alert('âŒ ' + result.error);
    }
  } catch (error) {
    alert('âŒ Erreur: ' + error.message);
  }
}
</script>
